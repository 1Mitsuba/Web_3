@page "{id:int?}"
@model TaskDetailModel
@{
    ViewData["Title"] = "Detalles de Tarea";
}

<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">@(Model.Task?.Id > 0 ? "Editar" : "Nueva") Tarea</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    <input type="hidden" asp-for="Task.Id" />
                    <input type="hidden" asp-for="Task.FechaCreacion" />
                    <input type="hidden" asp-for="ReturnPage" />

                    <div class="mb-3">
                        <label asp-for="Task.Nombre" class="form-label">Nombre de la tarea</label>
                        <input asp-for="Task.Nombre" class="form-control" id="taskNameAutocomplete" required />
                        <span asp-validation-for="Task.Nombre" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Task.Descripcion" class="form-label">Descripción</label>
                        <textarea asp-for="Task.Descripcion" class="form-control" rows="3"></textarea>
                        <span asp-validation-for="Task.Descripcion" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="Task.FechaVencimiento" class="form-label">Fecha de vencimiento</label>
                                <input asp-for="Task.FechaVencimiento" class="form-control" type="date" />
                                <span asp-validation-for="Task.FechaVencimiento" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Estado</label>
                                <div class="form-check">
                                    <input asp-for="Task.EstaCompletada" class="form-check-input" type="checkbox" id="taskCompleted" />
                                    <label class="form-check-label" for="taskCompleted">
                                        Completada
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input asp-for="Task.EstaCancelada" class="form-check-input" type="checkbox" id="taskCanceled" />
                                    <label class="form-check-label" for="taskCanceled">
                                        Cancelada
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a asp-page="@Model.ReturnPage" class="btn btn-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
        
        @if (Model.Task?.Id > 0)
        {
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">Información Adicional</h6>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">ID</dt>
                        <dd class="col-sm-8">@Model.Task.Id</dd>
                        
                        <dt class="col-sm-4">Fecha de creación</dt>
                        <dd class="col-sm-8">@Model.Task.FechaCreacion.ToString("dd/MM/yyyy HH:mm")</dd>
                        
                        <dt class="col-sm-4">Estado actual</dt>
                        <dd class="col-sm-8">
                            @if (Model.Task.EstaCompletada)
                            {
                                <span class="badge bg-success">Completada</span>
                            }
                            else if (Model.Task.EstaCancelada)
                            {
                                <span class="badge bg-danger">Cancelada</span>
                            }
                            else if (Model.Task.FechaVencimiento.HasValue && Model.Task.FechaVencimiento.Value < DateTime.Today)
                            {
                                <span class="badge bg-warning">Vencida</span>
                            }
                            else
                            {
                                <span class="badge bg-primary">Activa</span>
                            }
                        </dd>
                    </dl>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Asegurarse que solo uno de los checkboxes esté seleccionado
        document.getElementById('taskCompleted').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('taskCanceled').checked = false;
            }
        });
        
        document.getElementById('taskCanceled').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('taskCompleted').checked = false;
            }
        });
        
        // Configuración del autocompletado para nombres de tareas comunes
        $(function() {
            var commonTaskNames = [
                "Reunión de equipo",
                "Revisión de código",
                "Actualizar documentación",
                "Preparar presentación",
                "Llamar al cliente",
                "Enviar correo electrónico",
                "Crear informe mensual",
                "Revisar presupuesto",
                "Planificar sprint",
                "Investigar nuevas tecnologías",
                "Actualizar sitio web",
                "Entrevista con candidato",
                "Mantenimiento de base de datos",
                "Backup de sistemas",
                "Configurar entorno de desarrollo",
                "Implementar nueva característica",
                "Corrección de bugs",
                "Pruebas de calidad",
                "Optimizar rendimiento"
            ];
            
            $("#taskNameAutocomplete").autocomplete({
                source: commonTaskNames,
                minLength: 2,
                delay: 300,
                autoFocus: true,
                classes: {
                    "ui-autocomplete": "custom-autocomplete"
                }
            });
        });
    </script>
}